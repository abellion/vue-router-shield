{"mappings":"0XAEMA,cACSC,EAASC,GACpBC,KAAKF,QAAUA,EACfE,KAAKD,KAAOA,EAMXE,eAED,MAAMC,EAAQF,KAAKE,QAEnB,IAAK,IAAIC,KAASD,EAAO,CACvB,MAAME,QAAeJ,KAAKK,IAAIF,GAE9B,QAAeG,IAAXF,EACF,OAAOJ,KAAKD,KAAKK,GAIrB,OAAOJ,KAAKD,OAQdM,IAAKF,GACH,OAAO,IAAII,SAASC,IAClBL,EAAMH,KAAKF,QAAQW,GAAIT,KAAKF,QAAQY,KAAMF,MAQ9CN,QACE,MAAMA,EAAQ,IAAIS,IAElB,IAAK,IAAIC,KAASZ,KAAKF,QAAQW,GAAGI,QAC5BD,EAAME,KAAKC,eAAeC,EAASb,QACrCS,EAAME,KAAKE,EAASb,OAAOc,QAAQN,IAAIO,UAAUC,IAAKjB,GAI1D,OAAOkB,MAAMV,KAAKR,QAItBmB,EAEC,CAFeZ,EAAIC,EAAMX,KACxB,IAAIF,EAAM,IAAEY,OAAIC,GAAQX,GAAMuB,UCvDhCC,EAAgBpB,GACR,CAAEM,EAAIC,EAAMX,KAChBI,EAAMM,EAAIC,EAAMX,ICApByB,EAAgBrB,IACd,IAAIsB,EAAO,KAEX,MAAMC,EAAO,CAAIjB,EAAIC,EAAMX,KACzB,IAAI4B,GAAO,EAYX,GAVIF,GAAQA,EAAKf,KAAKkB,OAASlB,EAAKkB,MAAQH,EAAKhB,GAAGmB,OAASnB,EAAGmB,OAC9DD,GAAO,GAIPF,EADEE,EACK,KAEA,IAAElB,OAAIC,GAGXiB,EACF,OAAO5B,IAGT,IAAK,IAAI8B,KAASnB,EAAKG,QACrB,GAAIH,EAAKG,QAAQgB,GAAOf,KAAKC,eAAeC,EAASb,QAAUO,EAAKG,QAAQgB,GAAOf,KAAKE,EAASb,OAAO2B,SAASJ,IAAYhB,EAAKG,QAAQgB,KAAWpB,EAAGI,QAAQgB,GAC9J,OAAO9B,IAIXI,EAAMM,EAAIC,EAAMX,IAGlB,OAAO2B,GC7BTK,EAAgB5B,IACd,MAAMuB,EAAO,CAAIjB,EAAIC,EAAMX,KACzB,IAAK,IAAI8B,KAASnB,EAAKG,QACrB,GAAIH,EAAKG,QAAQgB,GAAOf,KAAKC,eAAeC,EAASb,QAAUO,EAAKG,QAAQgB,GAAOf,KAAKE,EAASb,OAAO2B,SAASJ,IAAYhB,EAAKG,QAAQgB,KAAWpB,EAAGI,QAAQgB,GAC9J,OAAO1B,EAAMM,EAAIC,EAAMX,GAI3BA,KAGF,OAAO2B,GCPF,MAAMV,EAAW,CACtBb,MAAO,oBAGuB6B,EAAKC,GACnC,IAAyB,IAArBC,QAAQD,KAA0D,IAArCA,EAAQlB,eAAe,UACtD,MAAM,IAAIoB,MAAM,4DAGdF,EAAQlB,eAAe,WACzBC,EAASb,MAAQ8B,EAAQ9B,OAG3B8B,EAAQG,OAAOC,WAAWhB","sources":["src/Guard.js","src/Guards/BeforeEach.js","src/Guards/BeforeEnter.js","src/Guards/BeforeUpdate.js","src/index.js"],"sourcesContent":["import { Settings } from './index'\n\nclass Guard {\n  constructor (request, next) {\n    this.request = request\n    this.next = next\n  }\n\n  /**\n   * Handle the guards\n   * @return mixed\n   */\n  async handle () {\n    const chain = this.chain()\n\n    for (let guard of chain) {\n      const result = await this.run(guard)\n\n      if (result !== undefined) {\n        return this.next(result)\n      }\n    }\n\n    return this.next()\n  }\n\n  /**\n   * Run a guard\n   * @param  function guard\n   * @return promise\n   */\n  run (guard) {\n    return new Promise((resolve) => {\n      guard(this.request.to, this.request.from, resolve)\n    })\n  }\n\n  /**\n   * Build the guards chain\n   * @return array\n   */\n  chain () {\n    const chain = new Set()\n\n    for (let route of this.request.to.matched) {\n      if (route.meta.hasOwnProperty(Settings.guard)) {\n        route.meta[Settings.guard].forEach(Set.prototype.add, chain)\n      }\n    }\n\n    return Array.from(chain)\n  }\n}\n\nexport default (to, from, next) => {\n  new Guard({ to, from }, next).handle()\n}\n","export default (guard) => {\n  return (to, from, next) => {\n    guard(to, from, next)\n  }\n}\n","import { Settings } from '../index'\n\nexport default (guard) => {\n  let last = null\n\n  const wrapper = (to, from, next) => {\n    let skip = false\n\n    if (last && last.from.path === from.path && last.to.path !== to.path) {\n      skip = true\n    }\n\n    if (skip) {\n      last = null\n    } else {\n      last = { to, from }\n    }\n\n    if (skip) {\n      return next()\n    }\n\n    for (let index in from.matched) {\n      if (from.matched[index].meta.hasOwnProperty(Settings.guard) && from.matched[index].meta[Settings.guard].includes(wrapper) && from.matched[index] === to.matched[index]) {\n        return next()\n      }\n    }\n\n    guard(to, from, next)\n  }\n\n  return wrapper\n}\n","import { Settings } from '../index'\n\nexport default (guard) => {\n  const wrapper = (to, from, next) => {\n    for (let index in from.matched) {\n      if (from.matched[index].meta.hasOwnProperty(Settings.guard) && from.matched[index].meta[Settings.guard].includes(wrapper) && from.matched[index] === to.matched[index]) {\n        return guard(to, from, next)\n      }\n    }\n\n    next()\n  }\n\n  return wrapper\n}\n","import Guard from './Guard'\n\nexport { default as BeforeEach } from './Guards/BeforeEach'\nexport { default as BeforeEnter } from './Guards/BeforeEnter'\nexport { default as BeforeUpdate } from './Guards/BeforeUpdate'\n\nexport const Settings = {\n  guard: 'guard'\n}\n\nexport default function install(vue, options) {\n  if (Boolean(options) !== true || options.hasOwnProperty('router') !== true) {\n    throw new Error('A Vue Router instance must be given to vue-router-shield')\n  }\n\n  if (options.hasOwnProperty('guard')) {\n    Settings.guard = options.guard\n  }\n\n  options.router.beforeEach(Guard)\n}\n"],"names":["$93b5ba20b7c6407f$var$Guard","request","next","this","async","chain","guard","result","run","undefined","Promise","resolve","to","from","Set","route","matched","meta","hasOwnProperty","$6dbc217b010a975b$export$c72f6eaae7b9adff","forEach","prototype","add","Array","$93b5ba20b7c6407f$export$2e2bcd8739ae039","handle","$4dc324b33f6b41f4$export$2e2bcd8739ae039","$fdff557f561d4944$export$2e2bcd8739ae039","last","wrapper","skip","path","index","includes","$9d1ec6dcc9074941$export$2e2bcd8739ae039","vue","options","Boolean","Error","router","beforeEach"],"version":3,"file":"index.cjs.js.map"}