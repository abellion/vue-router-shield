{"mappings":"MAEMA,cACSC,EAASC,GACpBC,KAAKF,QAAUA,EACfE,KAAKD,KAAOA,EAMXE,eAED,MAAMC,EAAQF,KAAKE,QAEnB,IAAK,IAAIC,KAASD,EAAO,CACvB,MAAME,QAAeJ,KAAKK,IAAIF,GAE9B,QAAeG,IAAXF,EACF,OAAOJ,KAAKD,KAAKK,GAIrB,OAAOJ,KAAKD,OAQdM,IAAKF,GACH,OAAO,IAAII,SAASC,IAClBL,EAAMH,KAAKF,QAAQW,GAAIT,KAAKF,QAAQY,KAAMF,MAQ9CN,QACE,MAAMA,EAAQ,IAAIS,IAElB,IAAK,IAAIC,KAASZ,KAAKF,QAAQW,GAAGI,QAC5BD,EAAME,KAAKC,eAAeC,EAASb,QACrCS,EAAME,KAAKE,EAASb,OAAOc,QAAQN,IAAIO,UAAUC,IAAKjB,GAI1D,OAAOkB,MAAMV,KAAKR,QAItBmB,EAEC,CAFeZ,EAAIC,EAAMX,KACxB,IAAIF,EAAM,IAAEY,OAAIC,GAAQX,GAAMuB,UCvDhCC,EAAgBpB,GACR,CAAEM,EAAIC,EAAMX,KAChBI,EAAMM,EAAIC,EAAMX,ICApByB,EAAgBrB,IACd,IAAIsB,EAAO,KAEX,MAAMC,EAAO,CAAIjB,EAAIC,EAAMX,KACzB,IAAI4B,GAAO,EAYX,GAVIF,GAAQA,EAAKf,KAAKkB,OAASlB,EAAKkB,MAAQH,EAAKhB,GAAGI,QAAQY,EAAKhB,GAAGI,QAAQgB,OAAS,GAAGD,OAASnB,EAAGI,QAAQJ,EAAGI,QAAQgB,OAAS,GAAGD,OACjID,GAAO,GAIPF,EADEE,EACK,KAEA,IAAElB,OAAIC,GAGXiB,EACF,OAAO5B,IAGT,IAAK,IAAI+B,KAASpB,EAAKG,QACrB,GAAIH,EAAKG,QAAQiB,GAAOhB,KAAKC,eAAeC,EAASb,QAAUO,EAAKG,QAAQiB,GAAOhB,KAAKE,EAASb,OAAO4B,SAASL,IAAYhB,EAAKG,QAAQiB,KAAWrB,EAAGI,QAAQiB,GAC9J,OAAO/B,IAIXI,EAAMM,EAAIC,EAAMX,IAGlB,OAAO2B,GC7BTM,EAAgB7B,IACd,MAAMuB,EAAO,CAAIjB,EAAIC,EAAMX,KACzB,IAAK,IAAI+B,KAASpB,EAAKG,QACrB,GAAIH,EAAKG,QAAQiB,GAAOhB,KAAKC,eAAeC,EAASb,QAAUO,EAAKG,QAAQiB,GAAOhB,KAAKE,EAASb,OAAO4B,SAASL,IAAYhB,EAAKG,QAAQiB,KAAWrB,EAAGI,QAAQiB,GAC9J,OAAO3B,EAAMM,EAAIC,EAAMX,GAI3BA,KAGF,OAAO2B,GCPF,MAAMV,EAAW,CACtBb,MAAO,oBAGuB8B,EAAKC,GACnC,IAAyB,IAArBC,QAAQD,KAA0D,IAArCA,EAAQnB,eAAe,UACtD,MAAM,IAAIqB,MAAM,4DAGdF,EAAQnB,eAAe,WACzBC,EAASb,MAAQ+B,EAAQ/B,OAG3B+B,EAAQG,OAAOC,WAAWjB","sources":["src/Guard.js","src/Guards/BeforeEach.js","src/Guards/BeforeEnter.js","src/Guards/BeforeUpdate.js","src/index.js"],"sourcesContent":["import { Settings } from './index'\n\nclass Guard {\n  constructor (request, next) {\n    this.request = request\n    this.next = next\n  }\n\n  /**\n   * Handle the guards\n   * @return mixed\n   */\n  async handle () {\n    const chain = this.chain()\n\n    for (let guard of chain) {\n      const result = await this.run(guard)\n\n      if (result !== undefined) {\n        return this.next(result)\n      }\n    }\n\n    return this.next()\n  }\n\n  /**\n   * Run a guard\n   * @param  function guard\n   * @return promise\n   */\n  run (guard) {\n    return new Promise((resolve) => {\n      guard(this.request.to, this.request.from, resolve)\n    })\n  }\n\n  /**\n   * Build the guards chain\n   * @return array\n   */\n  chain () {\n    const chain = new Set()\n\n    for (let route of this.request.to.matched) {\n      if (route.meta.hasOwnProperty(Settings.guard)) {\n        route.meta[Settings.guard].forEach(Set.prototype.add, chain)\n      }\n    }\n\n    return Array.from(chain)\n  }\n}\n\nexport default (to, from, next) => {\n  new Guard({ to, from }, next).handle()\n}\n","export default (guard) => {\n  return (to, from, next) => {\n    guard(to, from, next)\n  }\n}\n","import { Settings } from '../index'\n\nexport default (guard) => {\n  let last = null\n\n  const wrapper = (to, from, next) => {\n    let skip = false\n\n    if (last && last.from.path === from.path && last.to.matched[last.to.matched.length - 1].path !== to.matched[to.matched.length - 1].path) {\n      skip = true\n    }\n\n    if (skip) {\n      last = null\n    } else {\n      last = { to, from }\n    }\n\n    if (skip) {\n      return next()\n    }\n\n    for (let index in from.matched) {\n      if (from.matched[index].meta.hasOwnProperty(Settings.guard) && from.matched[index].meta[Settings.guard].includes(wrapper) && from.matched[index] === to.matched[index]) {\n        return next()\n      }\n    }\n\n    guard(to, from, next)\n  }\n\n  return wrapper\n}\n","import { Settings } from '../index'\n\nexport default (guard) => {\n  const wrapper = (to, from, next) => {\n    for (let index in from.matched) {\n      if (from.matched[index].meta.hasOwnProperty(Settings.guard) && from.matched[index].meta[Settings.guard].includes(wrapper) && from.matched[index] === to.matched[index]) {\n        return guard(to, from, next)\n      }\n    }\n\n    next()\n  }\n\n  return wrapper\n}\n","import Guard from './Guard'\n\nexport { default as BeforeEach } from './Guards/BeforeEach'\nexport { default as BeforeEnter } from './Guards/BeforeEnter'\nexport { default as BeforeUpdate } from './Guards/BeforeUpdate'\n\nexport const Settings = {\n  guard: 'guard'\n}\n\nexport default function install(vue, options) {\n  if (Boolean(options) !== true || options.hasOwnProperty('router') !== true) {\n    throw new Error('A Vue Router instance must be given to vue-router-shield')\n  }\n\n  if (options.hasOwnProperty('guard')) {\n    Settings.guard = options.guard\n  }\n\n  options.router.beforeEach(Guard)\n}\n"],"names":["$4ab05e376f6c4396$var$Guard","request","next","this","async","chain","guard","result","run","undefined","Promise","resolve","to","from","Set","route","matched","meta","hasOwnProperty","$c7cd4a810d0ec338$export$c72f6eaae7b9adff","forEach","prototype","add","Array","$4ab05e376f6c4396$export$2e2bcd8739ae039","handle","$fbd1b217618515b7$export$2e2bcd8739ae039","$a4ae4a5461961f79$export$2e2bcd8739ae039","last","wrapper","skip","path","length","index","includes","$adf23e1305b55d55$export$2e2bcd8739ae039","vue","options","Boolean","Error","router","beforeEach"],"version":3,"file":"index.esm.js.map"}